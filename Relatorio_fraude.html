<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt-BR" xml:lang="pt-BR"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Elton de Oliveira Jorge">

<title>Projeto de Detecção de Fraude</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="Relatorio_fraude_files/libs/clipboard/clipboard.min.js"></script>
<script src="Relatorio_fraude_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Relatorio_fraude_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Relatorio_fraude_files/libs/quarto-html/popper.min.js"></script>
<script src="Relatorio_fraude_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Relatorio_fraude_files/libs/quarto-html/anchor.min.js"></script>
<link href="Relatorio_fraude_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Relatorio_fraude_files/libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Relatorio_fraude_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Relatorio_fraude_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Relatorio_fraude_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sumário</h2>
   
  <ul>
  <li><a href="#introdução" id="toc-introdução" class="nav-link active" data-scroll-target="#introdução"><span class="header-section-number">1</span> Introdução</a></li>
  <li><a href="#objetivo-geral" id="toc-objetivo-geral" class="nav-link" data-scroll-target="#objetivo-geral"><span class="header-section-number">2</span> Objetivo Geral</a>
  <ul class="collapse">
  <li><a href="#objetivos-especificos" id="toc-objetivos-especificos" class="nav-link" data-scroll-target="#objetivos-especificos"><span class="header-section-number">2.1</span> Objetivos especificos</a></li>
  </ul></li>
  <li><a href="#metodologia" id="toc-metodologia" class="nav-link" data-scroll-target="#metodologia"><span class="header-section-number">3</span> Metodologia</a>
  <ul class="collapse">
  <li><a href="#fonte-e-caracterização-dos-dados" id="toc-fonte-e-caracterização-dos-dados" class="nav-link" data-scroll-target="#fonte-e-caracterização-dos-dados"><span class="header-section-number">3.1</span> Fonte e Caracterização dos dados</a></li>
  <li><a href="#pré-processamento-dos-dados" id="toc-pré-processamento-dos-dados" class="nav-link" data-scroll-target="#pré-processamento-dos-dados"><span class="header-section-number">3.2</span> Pré-processamento dos Dados</a></li>
  <li><a href="#modelagem-e-treinamento" id="toc-modelagem-e-treinamento" class="nav-link" data-scroll-target="#modelagem-e-treinamento"><span class="header-section-number">3.3</span> Modelagem e Treinamento</a></li>
  <li><a href="#avaliação-de-desempenho" id="toc-avaliação-de-desempenho" class="nav-link" data-scroll-target="#avaliação-de-desempenho"><span class="header-section-number">3.4</span> Avaliação de Desempenho</a></li>
  <li><a href="#análise-de-impacto-financeiro" id="toc-análise-de-impacto-financeiro" class="nav-link" data-scroll-target="#análise-de-impacto-financeiro"><span class="header-section-number">3.5</span> Análise de Impacto Financeiro</a></li>
  </ul></li>
  <li><a href="#análise-exploratória-e-pré-processamento" id="toc-análise-exploratória-e-pré-processamento" class="nav-link" data-scroll-target="#análise-exploratória-e-pré-processamento"><span class="header-section-number">4</span> Análise Exploratória e Pré-processamento</a>
  <ul class="collapse">
  <li><a href="#análise-exploratória-dos-dados-preparação-de-dados-e-engenharia-de-features" id="toc-análise-exploratória-dos-dados-preparação-de-dados-e-engenharia-de-features" class="nav-link" data-scroll-target="#análise-exploratória-dos-dados-preparação-de-dados-e-engenharia-de-features"><span class="header-section-number">4.1</span> Análise Exploratória dos Dados, Preparação de Dados e Engenharia de Features</a>
  <ul class="collapse">
  <li><a href="#distribuição-dos-valores-das-transaçõesamount" id="toc-distribuição-dos-valores-das-transaçõesamount" class="nav-link" data-scroll-target="#distribuição-dos-valores-das-transaçõesamount"><span class="header-section-number">4.1.1</span> Distribuição dos Valores das transações(Amount)</a></li>
  </ul></li>
  <li><a href="#análises-das-classes" id="toc-análises-das-classes" class="nav-link" data-scroll-target="#análises-das-classes"><span class="header-section-number">4.2</span> Análises das Classes</a></li>
  <li><a href="#teste-estatístico" id="toc-teste-estatístico" class="nav-link" data-scroll-target="#teste-estatístico"><span class="header-section-number">4.3</span> Teste Estatístico</a>
  <ul class="collapse">
  <li><a href="#ecdfempirical-cumulative-distribution-function" id="toc-ecdfempirical-cumulative-distribution-function" class="nav-link" data-scroll-target="#ecdfempirical-cumulative-distribution-function"><span class="header-section-number">4.3.1</span> : ECDF(Empirical Cumulative Distribution Function)</a></li>
  <li><a href="#testes-estatístico-sobre-variáveis-numéricas" id="toc-testes-estatístico-sobre-variáveis-numéricas" class="nav-link" data-scroll-target="#testes-estatístico-sobre-variáveis-numéricas"><span class="header-section-number">4.3.2</span> Testes estatístico sobre variáveis numéricas</a></li>
  </ul></li>
  <li><a href="#preparação-de-dados-e-engenharia-de-features" id="toc-preparação-de-dados-e-engenharia-de-features" class="nav-link" data-scroll-target="#preparação-de-dados-e-engenharia-de-features"><span class="header-section-number">4.4</span> Preparação de Dados e Engenharia de Features</a>
  <ul class="collapse">
  <li><a href="#escalonamento-de-dados" id="toc-escalonamento-de-dados" class="nav-link" data-scroll-target="#escalonamento-de-dados"><span class="header-section-number">4.4.1</span> Escalonamento de Dados</a></li>
  <li><a href="#balanceamento-de-classes" id="toc-balanceamento-de-classes" class="nav-link" data-scroll-target="#balanceamento-de-classes"><span class="header-section-number">4.4.2</span> Balanceamento de Classes</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#machine-learning-e-as-métricas-de-avaliação-de-desenpenho." id="toc-machine-learning-e-as-métricas-de-avaliação-de-desenpenho." class="nav-link" data-scroll-target="#machine-learning-e-as-métricas-de-avaliação-de-desenpenho."><span class="header-section-number">5</span> Machine Learning e as Métricas de Avaliação de Desenpenho.</a>
  <ul class="collapse">
  <li><a href="#métricas-de-avaliação-estatística" id="toc-métricas-de-avaliação-estatística" class="nav-link" data-scroll-target="#métricas-de-avaliação-estatística"><span class="header-section-number">5.1</span> Métricas de Avaliação Estatística</a></li>
  <li><a href="#métricas-de-avaliação-econômicas" id="toc-métricas-de-avaliação-econômicas" class="nav-link" data-scroll-target="#métricas-de-avaliação-econômicas"><span class="header-section-number">5.2</span> Métricas de Avaliação econômicas</a></li>
  <li><a href="#regressão-logística" id="toc-regressão-logística" class="nav-link" data-scroll-target="#regressão-logística"><span class="header-section-number">5.3</span> Regressão Logística</a></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest"><span class="header-section-number">5.4</span> Random Forest</a></li>
  <li><a href="#gradient-boosting" id="toc-gradient-boosting" class="nav-link" data-scroll-target="#gradient-boosting"><span class="header-section-number">5.5</span> Gradient Boosting</a></li>
  <li><a href="#xgboost" id="toc-xgboost" class="nav-link" data-scroll-target="#xgboost"><span class="header-section-number">5.6</span> XGBoost</a></li>
  <li><a href="#voting-classifier" id="toc-voting-classifier" class="nav-link" data-scroll-target="#voting-classifier"><span class="header-section-number">5.7</span> Voting Classifier</a></li>
  <li><a href="#stacking-classifier" id="toc-stacking-classifier" class="nav-link" data-scroll-target="#stacking-classifier"><span class="header-section-number">5.8</span> Stacking Classifier</a></li>
  <li><a href="#isolation-forest" id="toc-isolation-forest" class="nav-link" data-scroll-target="#isolation-forest"><span class="header-section-number">5.9</span> Isolation Forest</a></li>
  </ul></li>
  <li><a href="#considerações-finais" id="toc-considerações-finais" class="nav-link" data-scroll-target="#considerações-finais"><span class="header-section-number">6</span> Considerações Finais</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Projeto de Detecção de Fraude</h1>
<p class="subtitle lead">Usando Machine Learning para Detectar Fraudes</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor</div>
    <div class="quarto-title-meta-contents">
             <p>Elton de Oliveira Jorge </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Data de Publicação</div>
    <div class="quarto-title-meta-contents">
      <p class="date">17 de setembro de 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<style>
p {
  text-indent: 2em;    /* define recuo na primeira linha do parágrafo */
  text-align: justify; /* opcional: justifica o texto */
}
</style>
</div>
<section id="introdução" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introdução</h1>
<p>O crescimento exponencial das transações financeiras digitais impulsionou uma nova era de conveniência, mas também expôs o setor a ameaças cada vez mais sofisticadas. As fraudes em cartões de crédito representam uma dessas ameaças, resultando em perdas financeiras substanciais para instituições bancárias e prejuízos diretos aos usuários. Diante desse cenário, a análise preditiva e o aprendizado de máquina emergem como ferramentas essenciais para desenvolver sistemas de detecção de fraudes proativos e eficientes. Este trabalho propõe a construção de um modelo de classificação para identificar transações legítimas e fraudulentas, utilizando o conjunto de dados Credit Card Fraud Detection do Kaggle. A eficácia desse modelo é crucial não apenas para evitar perdas, mas também para assegurar a integridade e a segurança das operações financeiras.</p>
</section>
<section id="objetivo-geral" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Objetivo Geral</h1>
<p>Desenvolver um modelo de machine learning eficaz para a detecção de fraudes em transações de cartão de crédito, utilizando o conjunto de dados Credit Card Fraud Detection do Kaggle.</p>
<section id="objetivos-especificos" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="objetivos-especificos"><span class="header-section-number">2.1</span> Objetivos especificos</h2>
<ul>
<li><p>Analisar e explorar as características do conjunto de dados para identificar padrões relevantes e lidar com o desbalanceamento das classes.</p></li>
<li><p>Testar e comparar o desempenho de diversos algoritmos de classificação</p></li>
<li><p>Avaliar os modelos com base em métricas apropriadas para dados desbalanceados, com foco principal na Área sob a Curva de Precisão-Recall (PR-AUC), além de outras métricas como o F1-Score e a Matriz de Confusão.</p></li>
<li><p>Criar uma função de avaliação financeira que calcule o Retorno sobre o Investimento (ROI) e o Impacto Líquido do modelo.</p></li>
<li><p>Utilizar um valor hipotético de custo médio por fraude de R$ 5.000 e um custo de campanha contra a fraude de R$ 1.000 para parametrizar a função financeira.</p></li>
<li><p>Identificar o modelo com o melhor desempenho técnico e maior impacto financeiro para a tarefa de detecção de fraudes.</p></li>
</ul>
</section>
</section>
<section id="metodologia" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Metodologia</h1>
<section id="fonte-e-caracterização-dos-dados" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="fonte-e-caracterização-dos-dados"><span class="header-section-number">3.1</span> Fonte e Caracterização dos dados</h2>
<p>O presente estudo foi realizado com base no conjunto de dados “Credit Card Fraud Detection”, disponível na plataforma Kaggle. Este dataset contém 284.807 transações realizadas por cartões de crédito em setembro de 2013. Ele é composto por variáveis anônimas (V1 a V28), resultantes de uma transformação de <strong>Análise de Componentes Principais (PCA)</strong> para proteção da privacidade dos dados. As variáveis <strong>Time</strong> e <strong>Amount</strong> são originais, e a variável-alvo, <strong>Class</strong>, indica se a transação é fraudulenta (valor 1) ou não (valor 0). O conjunto de dados é altamente desbalanceado, com um número muito pequeno de transações fraudulentas.</p>
</section>
<section id="pré-processamento-dos-dados" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="pré-processamento-dos-dados"><span class="header-section-number">3.2</span> Pré-processamento dos Dados</h2>
<p>Antes da modelagem, o conjunto de dados passou por um processo de pré-processamento. Inicialmente, foi realizada uma <strong>análise exploratória dos dados (EDA)</strong> para compreender a distribuição das variáveis e a proporção da classe-alvo. Para mitigar o problema do desbalanceamento, foi aplicada a técnica de <strong>oversampling SMOTE</strong>, que cria amostras sintéticas da classe minoritária (fraude) para equilibrar a proporção das classes e evitar que o modelo se generalize mal. Em seguida, os dados foram divididos em conjuntos de treino e teste, garantindo uma avaliação imparcial do desempenho do modelo.</p>
</section>
<section id="modelagem-e-treinamento" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="modelagem-e-treinamento"><span class="header-section-number">3.3</span> Modelagem e Treinamento</h2>
<p>Para identificar o modelo com o melhor desempenho, foram avaliados diversos algoritmos de classificação. Inicialmente, utilizamos modelos de base como <strong>Regressão Logística</strong> e <strong>Árvore de Decisão</strong> para estabelecer uma performance inicial.</p>
<p>Em seguida, exploramos a força dos <strong>algoritmos de boosting</strong>, com o uso do <strong>Gradient Boosting</strong> e <strong>XGBoost</strong>, que é reconhecido pela sua alta performance em competições de machine learning.</p>
<p>Para ir além, aplicamos técnicas de ensemble como o <strong>Voting Classifier</strong> e o <strong>Stacking Classifier</strong>. Esses métodos combinam as previsões de múltiplos modelos para obter resultados mais robustos e precisos.</p>
<p>Por fim, testamos a abordagem do algoritmo <strong>não supervisionado Isolation Forest</strong>, que é particularmente eficaz para a detecção de anomalias, como é o caso de transações fraudulentas.</p>
<p>Cada modelo foi treinado com os dados pré-processados e validados, com foco na otimização de seus hiperparâmetros para garantir a melhor performance possível na tarefa de detecção de fraudes.</p>
</section>
<section id="avaliação-de-desempenho" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="avaliação-de-desempenho"><span class="header-section-number">3.4</span> Avaliação de Desempenho</h2>
<p>A performance dos modelos foi avaliada utilizando-se métricas específicas para problemas com classes desbalanceadas. O principal critério de avaliação foi a <strong>Área sob a Curva de Precisão-Recall (PR-AUC)</strong>, que é mais informativa que a <strong>Curva ROC</strong> em cenários com poucas classes positivas. Adicionalmente, também foram analisadas outras métricas como o <strong>F1-Score</strong>, a <strong>Precisão</strong> e o <strong>Recall</strong> para uma compreensão completa do desempenho de cada modelo.</p>
</section>
<section id="análise-de-impacto-financeiro" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="análise-de-impacto-financeiro"><span class="header-section-number">3.5</span> Análise de Impacto Financeiro</h2>
<p>Para além das métricas de desempenho técnico, foi desenvolvida uma função de avaliação financeira para mensurar o <strong>Impacto Líquido</strong> e o <strong>ROI</strong> dos modelos. Essa função considerou um valor hipotético de <strong>R$ 5.000</strong> como o custo médio de uma fraude e um <strong>custo de R$ 1.000</strong> para a confirmação de uma transação suspeita (falso positivo). O modelo com o melhor desempenho técnico e o maior impacto financeiro positivo foi selecionado como a solução final do projeto.</p>
</section>
</section>
<section id="análise-exploratória-e-pré-processamento" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Análise Exploratória e Pré-processamento</h1>
<p>Neste capítulo, mergulhamos no conhecimento e na preparação da nossa base de dados. Iremos explorar e analisar a distribuição das features, identificar as características mais relevantes e realizar testes estatísticos para validar nossas observações. Esta etapa é crucial para a pré-modelagem de dados, garantindo que a base esteja devidamente tratada e pronta para o desenvolvimento e a escolha dos algoritmos de machine learning.</p>
<section id="análise-exploratória-dos-dados-preparação-de-dados-e-engenharia-de-features" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="análise-exploratória-dos-dados-preparação-de-dados-e-engenharia-de-features"><span class="header-section-number">4.1</span> Análise Exploratória dos Dados, Preparação de Dados e Engenharia de Features</h2>
<p>A etapa inicial do projeto consistiu na análise exploratória dos dados (EDA) para compreender a estrutura e as características do conjunto de dados. Foi constatado que as variáveis V1 a V28 já haviam passado por uma transformação de <strong>Análise de Componentes Principais (PCA)</strong> para garantir a privacidade dos titulares dos cartões. As únicas variáveis originais mantidas foram o <strong>Time</strong> e a <strong>Amount</strong>, além da variável-alvo, <strong>Class</strong>.</p>
<p>Durante a análise, foi identificada a presença de cerca de 1062 registros duplicados. Para o tratamento desses dados, foi adotada uma abordagem estratégica para não comprometer a escassez de informações sobre a classe minoritária. Os dados duplicados da classe negativa (transações legítimas) foram removidos. No entanto, os registros duplicados da classe positiva (transações fraudulentas) foram mantidos. Essa decisão foi tomada para preservar cada exemplo da classe de fraude, considerada rara e de grande valor para o treinamento do modelo.</p>
<div id="9d7f820b" class="cell" data-execution_count="5">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-6-output-1.png" width="728" height="644" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>O desbalanceamento de classes é um problema central em qualquer projeto de detecção de fraudes. No nosso dataset, essa característica é evidente: as transações fraudulentas representam apenas 0,17% do total, enquanto as transações legítimas compõem a vasta maioria. Esse desequilíbrio representa um desafio significativo para a maioria dos algoritmos de machine learning, que tendem a se tornar tendenciosos e a falhar na detecção da classe minoritária. O gráfico a seguir ilustra essa distribuição desigual entre transações legítimas e fraudulentas.</p>
<div id="61c5f559" class="cell" data-execution_count="6">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-7-output-1.png" width="619" height="458" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Prevalência de fraude: 0.1727%</code></pre>
</div>
</div>
<section id="distribuição-dos-valores-das-transaçõesamount" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="distribuição-dos-valores-das-transaçõesamount"><span class="header-section-number">4.1.1</span> Distribuição dos Valores das transações(Amount)</h3>
<p>A análise da variável Amount, que representa o valor das transações, mostra um comportamento concentrado em valores baixos tanto nas operações legítimas (classe 0) quanto nas fraudulentas (classe 1).</p>
<div id="07fd5984" class="cell" data-execution_count="7">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-8-output-1.png" width="685" height="532" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>O gráfico a seguir ilustra a distribuição dos valores das transações em uma escala logarítmica para uma melhor visualização dos dados</p>
<div id="939002ee" class="cell" data-execution_count="8">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-9-output-1.png" width="672" height="551" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Nas transações não fraudulentas, observam-se alguns casos de valores extremamente altos, chegando a ultrapassar 25 mil. Esses valores são legítimos, mas funcionam como pontos fora da curva (outliers), comuns em operações de grande porte.</p>
<p>Nas transações fraudulentas, também existem outliers, porém em patamares significativamente menores. Isso indica que, embora a maioria das fraudes aconteça em valores baixos, dificilmente chegam ao volume financeiro observado em transações legítimas de maior valor.</p>
<p>Do ponto de vista de negócio, isso sugere que fraudes de alto valor são menos frequentes, mas ainda assim é essencial monitorar transações pequenas, que concentram a maior parte das ocorrências. Do ponto de vista de análise de dados, a variável Amount isoladamente não separa bem fraude de não fraude, mas fornece indícios que podem ser úteis quando combinada a outras variáveis em modelos de machine learning para detecção de fraudes.</p>
<p>Para aprofundar a análise da variável Amount e seu impacto direto no risco, foi calculada a taxa de fraude por decil de valor. O gráfico abaixo demonstra que a incidência de fraudes varia significativamente de acordo com a faixa de valor da transação, fornecendo uma visão clara de onde o risco é mais elevado.</p>
<div id="3a1f8b45" class="cell" data-execution_count="9">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-10-output-1.png" width="661" height="469" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="análises-das-classes" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="análises-das-classes"><span class="header-section-number">4.2</span> Análises das Classes</h2>
<p>A análise exploratória dos dados permite identificar padrões relevantes no comportamento das transações e no perfil das fraudes.</p>
<p>Primeiramente, avaliamos a distribuição do tempo das transações por classe. O gráfico abaixo mostra que tanto as transações legítimas quanto as fraudulentas ocorrem ao longo de todo o período observado, mas com concentrações diferentes em determinados intervalos. Essa diferença sugere que, em alguns horários, a incidência de fraude pode ser relativamente maior, o que pode ser explorado em estratégias de monitoramento, para identificar possíveis janelas de maior risco, mas deve ser usada em conjuntos com outras variáveis.</p>
<div id="ebc88391" class="cell" data-execution_count="10">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-11-output-1.png" width="757" height="756" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Em seguida, ao analisar a quantidade de transações por hora após a primeira operação, observa-se que o volume aumenta significativamente durante determinadas faixas horárias, refletindo picos de uso normal do sistema. Contudo, o percentual de fraudes (linha vermelha) não acompanha o mesmo padrão: ele é mais elevado nos primeiros horários, diminuindo gradativamente ao longo do tempo. Esse descompasso evidencia que, embora o volume de operações seja um fator importante, o risco de fraude está mais concentrado em momentos específicos do ciclo de uso.</p>
<div id="f0c9a00d" class="cell" data-execution_count="12">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-13-output-1.png" width="949" height="474" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Na sequência, avaliamos a taxa de fraude por decil de Amount de forma isolada. O gráfico em linha evidencia com clareza a dinâmica do risco ao longo das faixas de valor: o primeiro decil apresenta a maior taxa relativa de fraude, seguindo-se uma queda acentuada nas faixas intermediárias e um aumento progressivo nas faixas mais altas. Em outras palavras, o risco é elevado nos valores muito baixos, atinge um vale no centro e volta a subir em transações de maior valor. Do ponto de vista operacional, isso indica que regras e modelos separados por faixa de valor — em especial para faixas extremas — tendem a ser mais eficazes do que uma regra única para todo o universo de transações.</p>
<div id="470173fd" class="cell" data-execution_count="14">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-15-output-1.png" width="661" height="469" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Por fim, observamos a quantidade de transações junto com a taxa de fraude por decil de Amount. Esse gráfico combina barras (volume de transações) e linha (percentual de fraude), permitindo visualizar tanto a concentração de operações em valores intermediários quanto o comportamento de risco já observado nas extremidades. Embora as transações de valores baixos e altos sejam menos frequentes, sua taxa de fraude é significativamente maior, reforçando o papel crítico dessas faixas no desenho de políticas de prevenção.</p>
<div id="252b0a68" class="cell" data-execution_count="16">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-17-output-1.png" width="948" height="565" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>De forma integrada, essas análises mostram que o risco de fraude não está distribuído de maneira uniforme: ele varia tanto no tempo quanto em função do valor das transações. Para o negócio, esse resultado indica que estratégias de prevenção precisam considerar múltiplas dimensões — volume, horário e valor — em vez de tratar todos os casos de forma homogênea. Para a área de dados, os achados reforçam a importância de incorporar variáveis temporais e monetárias de forma segmentada nos modelos de detecção, pois elas capturam relações não lineares e interações relevantes para distinguir fraudes de transações legítimas.</p>
</section>
<section id="teste-estatístico" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="teste-estatístico"><span class="header-section-number">4.3</span> Teste Estatístico</h2>
<section id="ecdfempirical-cumulative-distribution-function" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="ecdfempirical-cumulative-distribution-function"><span class="header-section-number">4.3.1</span> : ECDF(Empirical Cumulative Distribution Function)</h3>
<p>A Função de Distribuição Empírica Acumulada (ECDF – Empirical Cumulative Distribution Function) é uma técnica estatística que mostra, para cada valor possível de uma variável, a proporção acumulada de observações menores ou iguais a ele. Diferente de histogramas ou boxplots, a ECDF preserva toda a informação dos dados, permitindo uma visão completa da distribuição sem perda de detalhes. Isso a torna especialmente útil em análises de detecção de fraude, pois permite comparar de forma precisa como os valores de transações se distribuem entre classes distintas.</p>
<div id="607e896a" class="cell" data-execution_count="17">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-18-output-1.png" width="589" height="477" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>No gráfico acima, observamos a comparação da ECDF do valor das transações (<strong>Amount</strong>) entre as classes 0 (transações legítimas) e 1 (transações fraudulentas). Nota-se que a curva da classe 1 se mantém abaixo da classe 0 nos valores iniciais, indicando que transações fraudulentas tendem a se concentrar em valores ligeiramente mais altos do que as transações legítimas. À medida que os valores aumentam, as duas curvas se aproximam, sugerindo que, em faixas mais altas, a diferença entre fraudes e transações normais se reduz.</p>
<p>A importância desse teste estatístico está em evidenciar diferenças sutis entre distribuições que poderiam passar despercebidas em análises tradicionais. Do ponto de vista de negócio, esse resultado sugere que pequenas variações no valor das transações já podem ser indicativas de risco, o que justifica incluir métricas derivadas de distribuição acumulada em modelos preditivos. Para estudos em ciência de dados, reforça-se a necessidade de técnicas estatísticas robustas para identificar padrões não triviais em dados desbalanceados.</p>
</section>
<section id="testes-estatístico-sobre-variáveis-numéricas" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="testes-estatístico-sobre-variáveis-numéricas"><span class="header-section-number">4.3.2</span> Testes estatístico sobre variáveis numéricas</h3>
<p>Para avaliar se as variáveis numéricas apresentam diferenças significativas entre transações fraudulentas e não fraudulentas, foram aplicados dois testes: o Mann-Whitney U e a correlação ponto-biserial.</p>
<p>O teste Mann-Whitney U é não paramétrico e verifica se duas distribuições independentes diferem de forma estatisticamente significativa. Ele é adequado para dados assimétricos, como os valores de transações financeiras. Já a correlação ponto-biserial mede a associação linear entre uma variável contínua e a variável binária de classe (fraude ou não fraude). Para ambos os testes, valores baixos de p-valor indicam que há evidências de diferença significativa entre as classes.</p>
<p>A tabela abaixo resume os resultados obtidos para a variável Amount, após o ajuste dos p-valores pelo método de Benjamini-Hochberg para múltiplas comparações:</p>
<div id="b029cadf" class="cell" data-execution_count="18">
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature</th>
<th data-quarto-table-cell-role="th">mw_p</th>
<th data-quarto-table-cell-role="th">pb_corr</th>
<th data-quarto-table-cell-role="th">pb_p</th>
<th data-quarto-table-cell-role="th">mw_p_adj</th>
<th data-quarto-table-cell-role="th">pb_p_adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Amount</td>
<td>NaN</td>
<td>0.005632</td>
<td>0.002651</td>
<td>1.0</td>
<td>0.002651</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Os resultados mostram que:</p>
<ul>
<li><p>O teste Mann-Whitney U não pôde ser computado devido ao forte desbalanceamento dos dados, que fez com que a classe minoritária (fraudes) não tivesse amostras suficientes para a comparação adequada.</p></li>
<li><p>A correlação ponto-biserial foi positiva, mas fraca (≈ 0,0056), indicando que Amount tem uma relação muito pequena com a variável alvo.</p></li>
<li><p>Apesar da correlação ser baixa, o p-valor corrigido foi significativo (0,0027), sugerindo que essa diferença, embora pequena, é estatisticamente confiável.</p></li>
</ul>
<p>Em síntese, a variável Amount apresenta diferenças estatisticamente significativas entre transações fraudulentas e não fraudulentas, mas a força da relação é baixa. Isso significa que Amount isoladamente não discrimina bem as classes, mas pode contribuir em conjunto com outras variáveis para aumentar a capacidade preditiva de modelos de detecção de fraude.</p>
</section>
</section>
<section id="preparação-de-dados-e-engenharia-de-features" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="preparação-de-dados-e-engenharia-de-features"><span class="header-section-number">4.4</span> Preparação de Dados e Engenharia de Features</h2>
<p>Nesta etapa, é fundamental definir claramente a variável explicativa (feature) e a variável alvo (target). As features são os atributos que utilizaremos para prever determinado resultado, enquanto a variável alvo representa a informação que se deseja prever.</p>
<p>Além disso, os dados foram divididos em conjuntos de treino e teste (e, quando necessário, validação). Essa separação é essencial para evitar o chamado data leakage, que ocorre quando o modelo tem acesso a informações de forma antecipada. O acesso precoce pode levar o modelo a memorizar os dados, apresentando bom desempenho durante o treinamento, mas falhando na previsão de novos dados. A separação garante uma avaliação justa, refletindo a capacidade real de generalização do modelo.</p>
<section id="escalonamento-de-dados" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="escalonamento-de-dados"><span class="header-section-number">4.4.1</span> Escalonamento de Dados</h3>
<p>Para padronização das features, foi utilizado o RobustScaler, que se mostra mais robusto em relação a outliers em comparação ao StandardScaler. O RobustScaler utiliza a mediana e o intervalo interquartil (IQR) ao invés da média e do desvio padrão, apresentando as seguintes características:</p>
<ul>
<li><p>Ignora a maioria dos valores atípicos;</p></li>
<li><p>Recomendado para datasets com muitos outliers;</p></li>
<li><p>Beneficia algoritmos sensíveis a outliers, como K-Means e Regressão Linear.</p></li>
</ul>
</section>
<section id="balanceamento-de-classes" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="balanceamento-de-classes"><span class="header-section-number">4.4.2</span> Balanceamento de Classes</h3>
<p>Para lidar com desbalanceamento de classes, aplicou-se o SMOTE (Synthetic Minority Over-sampling Technique). Esta técnica cria amostras sintéticas da classe minoritária com base nos vizinhos mais próximos, evitando duplicação de registros existentes. O uso do SMOTE contribui para que o modelo aprenda adequadamente as características de todas as classes, melhorando a performance em datasets desbalanceados.</p>
</section>
</section>
</section>
<section id="machine-learning-e-as-métricas-de-avaliação-de-desenpenho." class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Machine Learning e as Métricas de Avaliação de Desenpenho.</h1>
<p>Neste capítulo, serão apresentados os algoritmos testados neste estudo, assim como a comparação de seus resultados utilizando métricas estatísticas robustas (PR AUC, Recall e F1-Score).</p>
<p>Para fins de análise econômica, foi criada uma função simplificada, desenvolvida para estimar o impacto financeiro, o ROI (Retorno sobre Investimento) e a taxa de economia de cada modelo. Embora reconheçamos que diversos outros fatores possam influenciar os resultados financeiros, essa função fornece um norte para compreender o impacto real dos modelos nas finanças da empresa e auxilia na comparação prática entre eles.</p>
<section id="métricas-de-avaliação-estatística" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="métricas-de-avaliação-estatística"><span class="header-section-number">5.1</span> Métricas de Avaliação Estatística</h2>
<p>Para avaliar um modelo de Machine Learning, é fundamental compreender quais métricas devem ser utilizadas. Apoiar-se em uma métrica inadequada pode colocar em risco os resultados pretendidos. Existem diversas técnicas de avaliação; abaixo, listamos as principais:</p>
<ul>
<li><p><strong>Accuracy(Acurácia)</strong>: representa a proporção de previsões corretas em relação ao total de observações. É importante destacar que, em datasets desbalanceados, a acurácia pode ser enganosa, pois o modelo tende a prever corretamente apenas a classe majoritária, mascarando o desempenho real sobre a classe minoritária.</p></li>
<li><p><strong>ROC AUC(Área sob a curva ROC)</strong>: mede a capacidade do modelo de separar corretamente as classes. Essa métrica é geralmente acompanhada da Curva ROC, que plota a Taxa de Verdadeiros Positivos (Recall) versus a Taxa de Falsos Positivos (FPR). A área sob a curva (AUC) varia de 0,5 (modelo aleatório) a 1,0 (modelo perfeito).</p></li>
<li><p><strong>PR AUC(Área sob a Curva Precision-Recall)</strong>: Representa a área sob a curva Precision-Recall, sendo ideal para problemas muito desbalanceados, onde a classe minoritária é de maior interesse.</p></li>
<li><p><strong>Recall (Sensibilidade)</strong>: Proporção de verdadeiros positivos corretamente identificados pelo modelo. Essa métrica é essencial quando se deseja não deixar de detectar casos críticos, como fraudes.</p></li>
<li><p><strong>Precision (Precisão)</strong>: Proporção de previsões positivas que são realmente verdadeiras. Ajuda a reduzir falsos positivos, evitando alertas desnecessários.</p></li>
<li><p><strong>F1-Score</strong>: Média harmônica entre Precision e Recall, utilizada para equilibrar a detecção de positivos e a quantidade de falsos positivos. É especialmente útil em problemas desbalanceados, onde tanto a detecção quanto a precisão das previsões são críticas</p></li>
</ul>
<p>Diante de todas as métricas apresentadas e após uma análise cuidadosa, optou-se por utilizar a PR AUC como principal métrica de avaliação, especialmente por sua robustez em problemas desbalanceados. No entanto, todas as outras métricas continuam sendo relevantes, sendo essencial avaliar o modelo de forma abrangente, considerando diferentes perspectivas de desempenho para garantir resultados confiáveis e consistentes.</p>
</section>
<section id="métricas-de-avaliação-econômicas" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="métricas-de-avaliação-econômicas"><span class="header-section-number">5.2</span> Métricas de Avaliação econômicas</h2>
<p>Para auxiliar na avaliação dos modelos, serão utilizadas métricas financeiras, como ROI (Retorno sobre Investimento), taxa de economia e impacto financeiro. Para isso, utilizamos a média dos valores da coluna Amount da classe 1 (fraudes), que é de US$ 122,21, como referência do valor médio perdido por fraude.</p>
<p>Além disso, foi definido um valor hipotético de US$ 50,00 para o custo da campanha de prevenção à fraude, garantindo que o investimento seja menor que a perda média por fraude e permitindo avaliar o retorno econômico das ações propostas pelo modelo.</p>
<ul>
<li><strong>ROI (Retorno sobre Investimento)</strong>: O ROI mede o retorno obtido em relação ao custo da ação de prevenção à fraude. É calculado como:</li>
</ul>
<p><span class="math inline">\(\[
ROI = \frac{\text{Benefício líquido}}{\text{Custo da campanha}}
\]\)</span></p>
<ul>
<li><p>Benefício líquido: valor economizado ao prevenir fraudes menos o custo da campanha.</p></li>
<li><p>Um ROI maior que 1 indica que o investimento foi lucrativo; valores menores que 1 indicam que o custo da ação superou o benefício obtido.</p></li>
<li><p><strong>Taxa de Economia</strong>: A taxa de economia indica a proporção da perda financeira evitada pelo modelo em relação à perda total possível com fraudes. É uma métrica percentual que mostra quanto da fraude o modelo conseguiu prevenir, considerando o custo da campanha.</p></li>
<li><p><strong>Impacto Financeiro</strong>: O impacto financeiro representa o valor líquido economizado ao aplicar o modelo, considerando tanto os valores de fraude prevenidos quanto os custos da campanha de prevenção.</p></li>
<li><p>Calcula-se como:</p></li>
</ul>
<p><span class="math inline">\(\[
\text{Impacto Financeiro} = (\text{Fraudes prevenidas} \times \text{Valor médio da fraude}) - \text{Custo da campanha}
\]\)</span></p>
<ul>
<li>Permite entender quanto o modelo efetivamente contribuiu para reduzir perdas financeiras, auxiliando na tomada de decisão sobre a viabilidade econômica das ações.</li>
</ul>
</section>
<section id="regressão-logística" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="regressão-logística"><span class="header-section-number">5.3</span> Regressão Logística</h2>
<p>A regressão logística é um modelo estatístico utilizado para prever a probabilidade de ocorrência de um evento binário (sim/não, verdadeiro/falso) com base em uma ou mais variáveis independentes.</p>
<p>Ela transforma a relação entre as variáveis em uma probabilidade entre 0 e 1 utilizando a função logit, definida pela seguinte fórmula:</p>
<p><span class="math inline">\(\text{logit}(p) = \log\left(\frac{p}{1-p}\right) = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \cdots + \beta_n X_n\)</span></p>
<p>Onde: * <em>p</em> é a probabilidade do evento ocorrer;</p>
<ul>
<li><p><span class="math inline">\(X_1\)</span>, <span class="math inline">\(X_2\)</span>,…., <span class="math inline">\(X_n\)</span> são as variáveis independentes;</p></li>
<li><p><span class="math inline">\(\beta_1\)</span>, <span class="math inline">\(\beta_2\)</span>,…… <span class="math inline">\(\beta_n\)</span> são os coeficientes estimados pelo método de máximo verossimilhança para obter o melhor ajuste do modelo.</p></li>
</ul>
<p>O resultado final representa a chance de ocorrência do evento, sendo que valores acima de 0,5 são normalmente classificados como ocorrência do evento, e valores abaixo de 0,5 como ausência do evento.</p>
<p>No estudo foram avaliados três modelos de regressão logística, cada um com diferentes configurações e conjuntos de features. O objetivo foi comparar o desempenho de cada modelo na detecção de fraudes, utilizando as métricas estatísticas e financeiras apresentadas anteriormente (PR AUC, Recall, F1-Score, ROI, impacto financeiro e taxa de economia).</p>
<p>A seguir, são apresentados os resultados de cada modelo, destacando suas diferenças de performance e eficácia na prevenção de fraudes.</p>
<div id="21048d51" class="cell" data-execution_count="26">
<div class="cell-output cell-output-display" data-execution_count="26">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression(max_iter=1500, random_state=70)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>LogisticRegression</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(max_iter=1500, random_state=70)</pre></div> </div></div></div></div>
</div>
</div>
<div id="e09a4a11" class="cell" data-execution_count="27">
<div class="cell-output cell-output-stdout">
<pre><code>Métricas de Avaliações do Modelo
Regressão Logistica
Acurácia: 0.9755099891155508
ROC Auc: 0.9740707868684897
PR AUC: 0.7506487069670598
Matriz de confusão:
 [[55478  1386]
 [    9    89]]
              precision    recall  f1-score   support

           0       1.00      0.98      0.99     56864
           1       0.06      0.91      0.11        98

    accuracy                           0.98     56962
   macro avg       0.53      0.94      0.55     56962
weighted avg       1.00      0.98      0.99     56962
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-28-output-2.png" width="1141" height="982" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f66e120b" class="cell" data-execution_count="28">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-29-output-1.png" width="663" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="6fd55bc5" class="cell" data-execution_count="29">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Quantidade</th>
<th data-quarto-table-cell-role="th">Custo Campanha(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Não Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Impacto Líquido(R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FP</td>
<td>1386</td>
<td>R$-69,300.00</td>
<td>R$ 0.00</td>
<td>R$ 0.00</td>
<td>R$ -69,300.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FN</td>
<td>9</td>
<td>R$0.00</td>
<td>R$ 0.00</td>
<td>R$-1,099.89</td>
<td>R$ -1,099.89</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">VP</td>
<td>89</td>
<td>R$0.00</td>
<td>R$ 10,876.69</td>
<td>R$ 0.00</td>
<td>R$ 10,876.69</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>1484</td>
<td>R$ -69,300.00</td>
<td>R$ 10,876.69</td>
<td>R$ -1,099.89</td>
<td>R$ -59,523.20</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="40713d3a" class="cell" data-execution_count="30">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ROI (%)</th>
<th data-quarto-table-cell-role="th">Taxa Economia (%)</th>
<th data-quarto-table-cell-role="th">Custo por FN (R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Métricas Financeiras</td>
<td>-84.3%</td>
<td>90.8%</td>
<td>R$ -122.20999999999998</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Acima, foi aplicada a regressão logística utilizando o RobustScaler apenas na feature Amount. Abaixo, a mesma regressão logística foi treinada aplicando o RobustScaler em todas as features, permitindo observar o impacto da padronização completa no desempenho do modelo.</p>
<div id="17cb0f0d" class="cell" data-execution_count="31">
<div class="cell-output cell-output-display" data-execution_count="31">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression(max_iter=1500, random_state=70)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>LogisticRegression</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(max_iter=1500, random_state=70)</pre></div> </div></div></div></div>
</div>
</div>
<div id="eddfb66e" class="cell" data-execution_count="32">
<div class="cell-output cell-output-stdout">
<pre><code>Métricas de Avaliações do Modelo
Logistic Regression
Acurácia: 0.9734384326393034
ROC Auc: 0.9668984645067931
PR AUC: 0.7509659102193746
Matriz de confusão:
 [[55361  1503]
 [   10    88]]
              precision    recall  f1-score   support

           0       1.00      0.97      0.99     56864
           1       0.06      0.90      0.10        98

    accuracy                           0.97     56962
   macro avg       0.53      0.94      0.55     56962
weighted avg       1.00      0.97      0.99     56962
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-33-output-2.png" width="1141" height="982" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="99f0a52a" class="cell" data-execution_count="33">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-34-output-1.png" width="663" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="85fe7d8b" class="cell" data-execution_count="34">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Quantidade</th>
<th data-quarto-table-cell-role="th">Custo Campanha(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Não Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Impacto Líquido(R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FP</td>
<td>1503</td>
<td>R$-75,150.00</td>
<td>R$ 0.00</td>
<td>R$ 0.00</td>
<td>R$ -75,150.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FN</td>
<td>10</td>
<td>R$0.00</td>
<td>R$ 0.00</td>
<td>R$-1,222.10</td>
<td>R$ -1,222.10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">VP</td>
<td>88</td>
<td>R$0.00</td>
<td>R$ 10,754.48</td>
<td>R$ 0.00</td>
<td>R$ 10,754.48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>1601</td>
<td>R$ -75,150.00</td>
<td>R$ 10,754.48</td>
<td>R$ -1,222.10</td>
<td>R$ -65,617.62</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="35a01ee4" class="cell" data-execution_count="35">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ROI (%)</th>
<th data-quarto-table-cell-role="th">Taxa Economia (%)</th>
<th data-quarto-table-cell-role="th">Custo por FN (R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Métricas Financeiras</td>
<td>-85.7%</td>
<td>89.8%</td>
<td>R$ -122.21</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Após os dois modelos anteriores, aplicamos o HalvingGridSearch, um método de busca de hiperparâmetros mais eficiente que o GridSearch tradicional, pois vai eliminando combinações piores a cada iteração e focando nas melhores. Dessa forma, conseguimos encontrar um ajuste mais otimizado para o modelo logístico, sem a necessidade de testar exaustivamente todas as combinações possíveis.</p>
<div id="4fca14ae" class="cell" data-execution_count="36">
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\elton\anaconda3\Lib\site-packages\sklearn\linear_model\_logistic.py:1207: UserWarning:

Setting penalty=None will ignore the C and l1_ratio parameters
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<style>#sk-container-id-3 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-3 {
  color: var(--sklearn-color-text);
}

#sk-container-id-3 pre {
  padding: 0;
}

#sk-container-id-3 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-3 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-3 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-3 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-3 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-3 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-3 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-3 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-3 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-3 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-3 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-3 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-3 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-3 div.sk-label label.sk-toggleable__label,
#sk-container-id-3 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-3 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-3 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-3 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-3 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-3 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-3 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-3 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-3 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-3 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>HalvingGridSearchCV(cv=3,
                    estimator=LogisticRegression(max_iter=1500,
                                                 random_state=70),
                    factor=2, n_jobs=-1,
                    param_grid=[{'C': [0.01, 0.1, 0.5, 1, 10],
                                 'penalty': ['l1', 'l2'],
                                 'solver': ['liblinear', 'saga']},
                                {'C': [0.01, 0.3, 1, 10],
                                 'penalty': ['l2', None], 'solver': ['lbfgs']},
                                {'C': [1], 'penalty': [None],
                                 'solver': ['saga']}],
                    scoring='average_precision')</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox"><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>HalvingGridSearchCV</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.model_selection.HalvingGridSearchCV.html">?<span>Documentation for HalvingGridSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>HalvingGridSearchCV(cv=3,
                    estimator=LogisticRegression(max_iter=1500,
                                                 random_state=70),
                    factor=2, n_jobs=-1,
                    param_grid=[{'C': [0.01, 0.1, 0.5, 1, 10],
                                 'penalty': ['l1', 'l2'],
                                 'solver': ['liblinear', 'saga']},
                                {'C': [0.01, 0.3, 1, 10],
                                 'penalty': ['l2', None], 'solver': ['lbfgs']},
                                {'C': [1], 'penalty': [None],
                                 'solver': ['saga']}],
                    scoring='average_precision')</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox"><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>best_estimator_: LogisticRegression</div></div></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(C=0.01, max_iter=1500, penalty=None, random_state=70)</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox"><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>LogisticRegression</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a></div></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(C=0.01, max_iter=1500, penalty=None, random_state=70)</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
</div>
<div id="65afd65f" class="cell" data-execution_count="37">
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\elton\anaconda3\Lib\site-packages\sklearn\linear_model\_logistic.py:1207: UserWarning:

Setting penalty=None will ignore the C and l1_ratio parameters
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Métricas de Avaliações do Modelo
Regressão Logistica Otimizado
Acurácia: 0.9754573224254767
ROC Auc: 0.9741364645182777
PR AUC: 0.750851244751098
Matriz de confusão:
 [[55475  1389]
 [    9    89]]
              precision    recall  f1-score   support

           0       1.00      0.98      0.99     56864
           1       0.06      0.91      0.11        98

    accuracy                           0.98     56962
   macro avg       0.53      0.94      0.55     56962
weighted avg       1.00      0.98      0.99     56962
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-38-output-3.png" width="1141" height="982" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e86c5753" class="cell" data-execution_count="38">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-39-output-1.png" width="663" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e0ff7d7e" class="cell" data-execution_count="39">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Quantidade</th>
<th data-quarto-table-cell-role="th">Custo Campanha(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Não Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Impacto Líquido(R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FP</td>
<td>1389</td>
<td>R$-69,450.00</td>
<td>R$ 0.00</td>
<td>R$ 0.00</td>
<td>R$ -69,450.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FN</td>
<td>9</td>
<td>R$0.00</td>
<td>R$ 0.00</td>
<td>R$-1,099.89</td>
<td>R$ -1,099.89</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">VP</td>
<td>89</td>
<td>R$0.00</td>
<td>R$ 10,876.69</td>
<td>R$ 0.00</td>
<td>R$ 10,876.69</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>1487</td>
<td>R$ -69,450.00</td>
<td>R$ 10,876.69</td>
<td>R$ -1,099.89</td>
<td>R$ -59,673.20</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="c610de9b" class="cell" data-execution_count="40">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ROI (%)</th>
<th data-quarto-table-cell-role="th">Taxa Economia (%)</th>
<th data-quarto-table-cell-role="th">Custo por FN (R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Métricas Financeiras</td>
<td>-84.3%</td>
<td>90.8%</td>
<td>R$ -122.20999999999998</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="random-forest" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="random-forest"><span class="header-section-number">5.4</span> Random Forest</h2>
<p>O Random Forest é um algoritmo de aprendizado de máquina baseado em um conjunto de árvores de decisão. Ele constrói uma “floresta” de múltiplas árvores e combina os resultados obtidos por elas, resultando em maior precisão e robustez em comparação com uma única árvore de decisão.</p>
<p>Cada árvore é treinada a partir de amostras geradas por bootstrap (amostragem com reposição) e, em cada divisão de nó, o algoritmo considera apenas um subconjunto aleatório de variáveis. Essa estratégia aumenta a diversidade entre as árvores, reduzindo a variância do modelo e mitigando problemas de overfitting.</p>
<div id="f95cd8fb" class="cell" data-execution_count="41">
<div class="cell-output cell-output-stdout">
<pre><code>Métricas de Avaliações do Modelo
Random Forest
Acurácia: 0.995593553597135
ROC Auc: 0.9709011224776911
PR AUC: 0.6813204936315306
Matriz de confusão:
 [[56625   239]
 [   12    86]]
              precision    recall  f1-score   support

           0       1.00      1.00      1.00     56864
           1       0.26      0.88      0.41        98

    accuracy                           1.00     56962
   macro avg       0.63      0.94      0.70     56962
weighted avg       1.00      1.00      1.00     56962
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-42-output-2.png" width="1141" height="982" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="0f75166a" class="cell" data-execution_count="42">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-43-output-1.png" width="663" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="9e111322" class="cell" data-execution_count="43">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Quantidade</th>
<th data-quarto-table-cell-role="th">Custo Campanha(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Não Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Impacto Líquido(R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FP</td>
<td>239</td>
<td>R$-11,950.00</td>
<td>R$ 0.00</td>
<td>R$ 0.00</td>
<td>R$ -11,950.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FN</td>
<td>12</td>
<td>R$0.00</td>
<td>R$ 0.00</td>
<td>R$-1,466.52</td>
<td>R$ -1,466.52</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">VP</td>
<td>86</td>
<td>R$0.00</td>
<td>R$ 10,510.06</td>
<td>R$ 0.00</td>
<td>R$ 10,510.06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>337</td>
<td>R$ -11,950.00</td>
<td>R$ 10,510.06</td>
<td>R$ -1,466.52</td>
<td>R$ -2,906.46</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="71601eb1" class="cell" data-execution_count="44">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ROI (%)</th>
<th data-quarto-table-cell-role="th">Taxa Economia (%)</th>
<th data-quarto-table-cell-role="th">Custo por FN (R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Métricas Financeiras</td>
<td>-12.0%</td>
<td>87.8%</td>
<td>R$ -122.21</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Para otimizar o desempenho do modelo Random Forest, aplicamos o HalvingGridSearch, uma técnica de busca de hiperparâmetros que avalia diferentes combinações de forma iterativa, reduzindo progressivamente o número de candidatos e mantendo apenas os mais promissores.</p>
<p>Esse procedimento permite encontrar configurações mais adequadas para o modelo sem a necessidade de testar exaustivamente todas as combinações possíveis, tornando o processo mais eficiente.</p>
<div id="fe7bf571" class="cell" data-execution_count="45">
<div class="cell-output cell-output-stdout">
<pre><code>n_iterations: 5
n_required_iterations: 5
n_possible_iterations: 5
min_resources_: 28431
max_resources_: 454902
aggressive_elimination: False
factor: 2
----------
iter: 0
n_candidates: 27
n_resources: 28431
Fitting 3 folds for each of 27 candidates, totalling 81 fits
----------
iter: 1
n_candidates: 14
n_resources: 56862
Fitting 3 folds for each of 14 candidates, totalling 42 fits
----------
iter: 2
n_candidates: 7
n_resources: 113724
Fitting 3 folds for each of 7 candidates, totalling 21 fits
----------
iter: 3
n_candidates: 4
n_resources: 227448
Fitting 3 folds for each of 4 candidates, totalling 12 fits
----------
iter: 4
n_candidates: 2
n_resources: 454896
Fitting 3 folds for each of 2 candidates, totalling 6 fits</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="45">
<style>#sk-container-id-4 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-4 {
  color: var(--sklearn-color-text);
}

#sk-container-id-4 pre {
  padding: 0;
}

#sk-container-id-4 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-4 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-4 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-4 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-4 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-4 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-4 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-4 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-4 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-4 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-4 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-4 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-4 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-4 div.sk-label label.sk-toggleable__label,
#sk-container-id-4 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-4 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-4 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-4 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-4 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-4 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-4 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-4 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-4 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-4 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>HalvingGridSearchCV(cv=3, estimator=RandomForestClassifier(random_state=70),
                    factor=2, n_jobs=-1,
                    param_grid={'max_depth': [3, 5, 10],
                                'min_samples_split': [2, 4, 5],
                                'n_estimators': [25, 50, 100]},
                    scoring='average_precision', verbose=1)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox"><label for="sk-estimator-id-6" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>HalvingGridSearchCV</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.model_selection.HalvingGridSearchCV.html">?<span>Documentation for HalvingGridSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>HalvingGridSearchCV(cv=3, estimator=RandomForestClassifier(random_state=70),
                    factor=2, n_jobs=-1,
                    param_grid={'max_depth': [3, 5, 10],
                                'min_samples_split': [2, 4, 5],
                                'n_estimators': [25, 50, 100]},
                    scoring='average_precision', verbose=1)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox"><label for="sk-estimator-id-7" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>best_estimator_: RandomForestClassifier</div></div></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(max_depth=10, min_samples_split=4, random_state=70)</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox"><label for="sk-estimator-id-8" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>RandomForestClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a></div></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(max_depth=10, min_samples_split=4, random_state=70)</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
</div>
<div id="b5c08c49" class="cell" data-execution_count="46">
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\elton\anaconda3\Lib\site-packages\sklearn\utils\validation.py:2739: UserWarning:

X does not have valid feature names, but LogisticRegression was fitted with feature names
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Métricas de Avaliações do Modelo
Random Forest Otimizado
Acurácia: 0.9977704434535304
ROC Auc: 0.9666358436312059
PR AUC: 0.4640299127794485
Matriz de confusão:
 [[56750   114]
 [   13    85]]
              precision    recall  f1-score   support

           0       1.00      1.00      1.00     56864
           1       0.43      0.87      0.57        98

    accuracy                           1.00     56962
   macro avg       0.71      0.93      0.79     56962
weighted avg       1.00      1.00      1.00     56962
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-47-output-3.png" width="1141" height="982" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="748df840" class="cell" data-execution_count="47">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-48-output-1.png" width="663" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="d80bc48e" class="cell" data-execution_count="48">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Quantidade</th>
<th data-quarto-table-cell-role="th">Custo Campanha(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Não Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Impacto Líquido(R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FP</td>
<td>114</td>
<td>R$-5,700.00</td>
<td>R$ 0.00</td>
<td>R$ 0.00</td>
<td>R$ -5,700.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FN</td>
<td>13</td>
<td>R$0.00</td>
<td>R$ 0.00</td>
<td>R$-1,588.73</td>
<td>R$ -1,588.73</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">VP</td>
<td>85</td>
<td>R$0.00</td>
<td>R$ 10,387.85</td>
<td>R$ 0.00</td>
<td>R$ 10,387.85</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>212</td>
<td>R$ -5,700.00</td>
<td>R$ 10,387.85</td>
<td>R$ -1,588.73</td>
<td>R$ 3,099.12</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="7cb51dba" class="cell" data-execution_count="49">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ROI (%)</th>
<th data-quarto-table-cell-role="th">Taxa Economia (%)</th>
<th data-quarto-table-cell-role="th">Custo por FN (R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Métricas Financeiras</td>
<td>82.2%</td>
<td>86.7%</td>
<td>R$ -122.21000000000001</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="gradient-boosting" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="gradient-boosting"><span class="header-section-number">5.5</span> Gradient Boosting</h2>
<p>O Gradient Boosting é uma técnica de aprendizado de máquina aplicada a problemas de classificação e regressão, que constrói um modelo robusto a partir da combinação iterativa de vários modelos fracos, geralmente árvores de decisão. A cada iteração, o algoritmo ajusta um novo modelo para corrigir os erros residuais do modelo anterior, otimizando a função de perda por meio do gradiente, o que resulta em melhoria contínua na precisão das predições.</p>
<div id="363f0f40" class="cell" data-execution_count="50">
<div class="cell-output cell-output-display" data-execution_count="50">
<style>#sk-container-id-5 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-5 {
  color: var(--sklearn-color-text);
}

#sk-container-id-5 pre {
  padding: 0;
}

#sk-container-id-5 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-5 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-5 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-5 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-5 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-5 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-5 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-5 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-5 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-5 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-5 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-5 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-5 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-5 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-5 div.sk-label label.sk-toggleable__label,
#sk-container-id-5 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-5 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-5 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-5 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-5 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-5 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-5 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-5 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-5 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-5 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GradientBoostingClassifier(learning_rate=0.2, max_depth=5, random_state=70)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" checked=""><label for="sk-estimator-id-9" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>GradientBoostingClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html">?<span>Documentation for GradientBoostingClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>GradientBoostingClassifier(learning_rate=0.2, max_depth=5, random_state=70)</pre></div> </div></div></div></div>
</div>
</div>
<div id="a5c8603a" class="cell" data-execution_count="51">
<div class="cell-output cell-output-stdout">
<pre><code>Métricas de Avaliações do Modelo
Gradient Boosting
Acurácia: 0.9987711105649381
ROC Auc: 0.9510994007901415
PR AUC: 0.8306687296312546
Matriz de confusão:
 [[56809    55]
 [   15    83]]
              precision    recall  f1-score   support

           0       1.00      1.00      1.00     56864
           1       0.60      0.85      0.70        98

    accuracy                           1.00     56962
   macro avg       0.80      0.92      0.85     56962
weighted avg       1.00      1.00      1.00     56962
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-52-output-2.png" width="1141" height="982" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="158f9c7e" class="cell" data-execution_count="52">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-53-output-1.png" width="663" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="2f4fbdbb" class="cell" data-execution_count="53">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Quantidade</th>
<th data-quarto-table-cell-role="th">Custo Campanha(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Não Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Impacto Líquido(R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FP</td>
<td>55</td>
<td>R$-2,750.00</td>
<td>R$ 0.00</td>
<td>R$ 0.00</td>
<td>R$ -2,750.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FN</td>
<td>15</td>
<td>R$0.00</td>
<td>R$ 0.00</td>
<td>R$-1,833.15</td>
<td>R$ -1,833.15</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">VP</td>
<td>83</td>
<td>R$0.00</td>
<td>R$ 10,143.43</td>
<td>R$ 0.00</td>
<td>R$ 10,143.43</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>153</td>
<td>R$ -2,750.00</td>
<td>R$ 10,143.43</td>
<td>R$ -1,833.15</td>
<td>R$ 5,560.28</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="3048d51f" class="cell" data-execution_count="54">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ROI (%)</th>
<th data-quarto-table-cell-role="th">Taxa Economia (%)</th>
<th data-quarto-table-cell-role="th">Custo por FN (R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Métricas Financeiras</td>
<td>268.9%</td>
<td>84.7%</td>
<td>R$ -122.21</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="xgboost" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="xgboost"><span class="header-section-number">5.6</span> XGBoost</h2>
<p>O XGBoost (Extreme Gradient Boosting) é uma implementação avançada e otimizada do algoritmo de Gradient Boosting, amplamente utilizada em aprendizado de máquina. Ele constrói um modelo robusto e preciso combinando várias árvores de decisão “fracas” de forma sequencial, onde cada nova árvore corrige os erros residuais das anteriores. Para isso, utiliza a descida do gradiente na otimização da função de perda. Além de sua capacidade de gerar predições mais acuradas, o XGBoost se destaca pela eficiência computacional, controle de overfitting e escalabilidade, tornando-o especialmente adequado para grandes volumes de dados e aplicações em ambientes gerenciais que exigem resultados confiáveis.</p>
<div id="3dcf9b7c" class="cell" data-execution_count="55">
<div class="cell-output cell-output-display" data-execution_count="55">
<style>#sk-container-id-6 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-6 {
  color: var(--sklearn-color-text);
}

#sk-container-id-6 pre {
  padding: 0;
}

#sk-container-id-6 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-6 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-6 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-6 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-6 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-6 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-6 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-6 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-6 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-6 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-6 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-6 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-6 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-6 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-6 div.sk-label label.sk-toggleable__label,
#sk-container-id-6 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-6 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-6 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-6 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-6 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-6 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-6 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-6 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-6 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-6 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-6" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=0.8, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric='logloss',
              feature_types=None, feature_weights=None, gamma=None,
              grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.2, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=5, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              multi_strategy=None, n_estimators=100, n_jobs=None,
              num_parallel_tree=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" checked=""><label for="sk-estimator-id-10" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>XGBClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://xgboost.readthedocs.io/en/release_3.0.0/python/python_api.html#xgboost.XGBClassifier">?<span>Documentation for XGBClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=0.8, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric='logloss',
              feature_types=None, feature_weights=None, gamma=None,
              grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.2, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=5, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              multi_strategy=None, n_estimators=100, n_jobs=None,
              num_parallel_tree=None, ...)</pre></div> </div></div></div></div>
</div>
</div>
<div id="deebdd82" class="cell" data-execution_count="56">
<div class="cell-output cell-output-stdout">
<pre><code>Métricas de Avaliações do Modelo
XGBoost
Acurácia: 0.9988062216916541
ROC Auc: 0.9684953645217231
PR AUC: 0.8647665389101784
Matriz de confusão:
 [[56808    56]
 [   12    86]]
              precision    recall  f1-score   support

           0       1.00      1.00      1.00     56864
           1       0.61      0.88      0.72        98

    accuracy                           1.00     56962
   macro avg       0.80      0.94      0.86     56962
weighted avg       1.00      1.00      1.00     56962
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-57-output-2.png" width="1141" height="982" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="19c7a9ab" class="cell" data-execution_count="57">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-58-output-1.png" width="663" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="924754cd" class="cell" data-execution_count="58">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Quantidade</th>
<th data-quarto-table-cell-role="th">Custo Campanha(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Não Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Impacto Líquido(R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FP</td>
<td>56</td>
<td>R$-2,800.00</td>
<td>R$ 0.00</td>
<td>R$ 0.00</td>
<td>R$ -2,800.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FN</td>
<td>12</td>
<td>R$0.00</td>
<td>R$ 0.00</td>
<td>R$-1,466.52</td>
<td>R$ -1,466.52</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">VP</td>
<td>86</td>
<td>R$0.00</td>
<td>R$ 10,510.06</td>
<td>R$ 0.00</td>
<td>R$ 10,510.06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>154</td>
<td>R$ -2,800.00</td>
<td>R$ 10,510.06</td>
<td>R$ -1,466.52</td>
<td>R$ 6,243.54</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="dceb42b8" class="cell" data-execution_count="59">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ROI (%)</th>
<th data-quarto-table-cell-role="th">Taxa Economia (%)</th>
<th data-quarto-table-cell-role="th">Custo por FN (R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Métricas Financeiras</td>
<td>275.4%</td>
<td>87.8%</td>
<td>R$ -122.21</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="voting-classifier" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="voting-classifier"><span class="header-section-number">5.7</span> Voting Classifier</h2>
<p>O Voting Classifier é um método de ensemble em aprendizado de máquina que combina múltiplos algoritmos base para gerar uma predição final mais robusta e frequentemente mais precisa do que qualquer modelo individual. Ele funciona reunindo classificações diferentes (como árvore de decisão, SVM, regressão logística, Gradient Boosting e XGBoost Classifier) e tomando decisões por maioria de votos ou pela média das probabilidades de cada classe. Neste modelo específico, o Voting Classifier foi treinado utilizando apenas Gradient Boosting e XGBoost, aproveitando a robustez e precisão desses algoritmos para melhorar o desempenho do ensemble.</p>
<div id="eb294789" class="cell" data-execution_count="61">
<div class="cell-output cell-output-stdout">
<pre><code>Métricas de Avaliações do Modelo
Voting Classifier
Acurácia: 0.9985253326779256
ROC Auc: 0.9693394838239178
PR AUC: 0.8560779030617364
Matriz de confusão:
 [[56793    71]
 [   13    85]]
              precision    recall  f1-score   support

           0       1.00      1.00      1.00     56864
           1       0.54      0.87      0.67        98

    accuracy                           1.00     56962
   macro avg       0.77      0.93      0.83     56962
weighted avg       1.00      1.00      1.00     56962
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-62-output-2.png" width="1141" height="982" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="83302484" class="cell" data-execution_count="62">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-63-output-1.png" width="663" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="931e9792" class="cell" data-execution_count="63">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Quantidade</th>
<th data-quarto-table-cell-role="th">Custo Campanha(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Não Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Impacto Líquido(R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FP</td>
<td>71</td>
<td>R$-3,550.00</td>
<td>R$ 0.00</td>
<td>R$ 0.00</td>
<td>R$ -3,550.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FN</td>
<td>13</td>
<td>R$0.00</td>
<td>R$ 0.00</td>
<td>R$-1,588.73</td>
<td>R$ -1,588.73</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">VP</td>
<td>85</td>
<td>R$0.00</td>
<td>R$ 10,387.85</td>
<td>R$ 0.00</td>
<td>R$ 10,387.85</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>169</td>
<td>R$ -3,550.00</td>
<td>R$ 10,387.85</td>
<td>R$ -1,588.73</td>
<td>R$ 5,249.12</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="524f9bb5" class="cell" data-execution_count="64">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ROI (%)</th>
<th data-quarto-table-cell-role="th">Taxa Economia (%)</th>
<th data-quarto-table-cell-role="th">Custo por FN (R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Métricas Financeiras</td>
<td>192.6%</td>
<td>86.7%</td>
<td>R$ -122.21000000000001</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="stacking-classifier" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="stacking-classifier"><span class="header-section-number">5.8</span> Stacking Classifier</h2>
<p>O Stacking Classifier é uma técnica de ensemble em aprendizado de máquina que combina múltiplos algoritmos de classificação para formar um modelo ainda mais robusto e preciso. Diferentemente do Voting Classifier, o empilhamento utiliza um meta-classificador para aprender a combinar os modelos base, identificando padrões que cada modelo individual não consegue capturar sozinho. Neste caso específico, o modelo foi treinado utilizando Gradient Boosting e XGBoost como modelos base, e regressão logística como meta-classificador. É importante ressaltar que, devido a limitações computacionais, os testes foram realizados com uma amostra representativa, respeitando o equilíbrio entre as classes.</p>
<div id="da481754" class="cell" data-execution_count="65">
<div class="cell-output cell-output-stdout">
<pre><code>Tamanho original do conjunto de treino: 227845
Tamanho da amostra de treino: 18227
------------------------------
Iniciando a validação cruzada com a amostra...
PR AUC médio (CV) na amostra: 0.7167263892401142
Desvio padrão na amostra: 0.01561399294747192
------------------------------
Treinando o modelo final com a amostra SMOTE...
Modelo treinado com sucesso!
------------------------------
Métricas de Avaliações do Modelo
Stacking Classifier
Acurácia: 0.9959446648642954
ROC Auc: 0.9675548821104131
PR AUC: 0.7365152993549122
Matriz de confusão:
 [[56646   218]
 [   13    85]]
              precision    recall  f1-score   support

           0       1.00      1.00      1.00     56864
           1       0.28      0.87      0.42        98

    accuracy                           1.00     56962
   macro avg       0.64      0.93      0.71     56962
weighted avg       1.00      1.00      1.00     56962
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-66-output-2.png" width="1141" height="982" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e6668d38" class="cell" data-execution_count="66">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-67-output-1.png" width="663" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="999275a2" class="cell" data-execution_count="67">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Quantidade</th>
<th data-quarto-table-cell-role="th">Custo Campanha(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Não Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Impacto Líquido(R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FP</td>
<td>218</td>
<td>R$-10,900.00</td>
<td>R$ 0.00</td>
<td>R$ 0.00</td>
<td>R$ -10,900.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FN</td>
<td>13</td>
<td>R$0.00</td>
<td>R$ 0.00</td>
<td>R$-1,588.73</td>
<td>R$ -1,588.73</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">VP</td>
<td>85</td>
<td>R$0.00</td>
<td>R$ 10,387.85</td>
<td>R$ 0.00</td>
<td>R$ 10,387.85</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>316</td>
<td>R$ -10,900.00</td>
<td>R$ 10,387.85</td>
<td>R$ -1,588.73</td>
<td>R$ -2,100.88</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="f491aa0e" class="cell" data-execution_count="68">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ROI (%)</th>
<th data-quarto-table-cell-role="th">Taxa Economia (%)</th>
<th data-quarto-table-cell-role="th">Custo por FN (R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Métricas Financeiras</td>
<td>-4.7%</td>
<td>86.7%</td>
<td>R$ -122.21000000000001</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="isolation-forest" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="isolation-forest"><span class="header-section-number">5.9</span> Isolation Forest</h2>
<p>O Isolation Forest é um algoritmo de aprendizado de máquina não supervisionado projetado principalmente para a detecção de anomalias (outliers) em conjuntos de dados. Ele se mostra muito eficiente em problemas com grandes volumes de dados e alta dimensionalidade. Inspirado em técnicas de ensemble baseadas em árvores, o Isolation Forest opera de forma distinta de outros métodos, isolando rapidamente instâncias que se desviam dos padrões normais, o que permite identificar outliers com menor custo computacional e maior rapidez.</p>
<div id="2ed892ed" class="cell" data-execution_count="69">
<div class="cell-output cell-output-stdout">
<pre><code>Matriz de confusão:
[[56795    69]
 [   73    25]]

Classification Report:
              precision    recall  f1-score   support

           0     0.9987    0.9988    0.9988     56864
           1     0.2660    0.2551    0.2604        98

    accuracy                         0.9975     56962
   macro avg     0.6323    0.6269    0.6296     56962
weighted avg     0.9975    0.9975    0.9975     56962


ROC AUC: 0.9421
PR AUC : 0.1441</code></pre>
</div>
</div>
<div id="368eb33b" class="cell" data-execution_count="70">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-71-output-1.png" width="655" height="537" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="93853fad" class="cell" data-execution_count="71">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-72-output-1.png" width="518" height="537" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="14f8800b" class="cell" data-execution_count="72">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Relatorio_fraude_files/figure-html/cell-73-output-1.png" width="518" height="537" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="7351148b" class="cell" data-execution_count="73">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Quantidade</th>
<th data-quarto-table-cell-role="th">Custo Campanha(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Fraude Não Evitada(R$)</th>
<th data-quarto-table-cell-role="th">Impacto Líquido(R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FP</td>
<td>69</td>
<td>R$-3,450.00</td>
<td>R$ 0.00</td>
<td>R$ 0.00</td>
<td>R$ -3,450.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FN</td>
<td>73</td>
<td>R$0.00</td>
<td>R$ 0.00</td>
<td>R$-8,921.33</td>
<td>R$ -8,921.33</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">VP</td>
<td>25</td>
<td>R$0.00</td>
<td>R$ 3,055.25</td>
<td>R$ 0.00</td>
<td>R$ 3,055.25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>167</td>
<td>R$ -3,450.00</td>
<td>R$ 3,055.25</td>
<td>R$ -8,921.33</td>
<td>R$ -9,316.08</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="35d058a8" class="cell" data-execution_count="74">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ROI (%)</th>
<th data-quarto-table-cell-role="th">Taxa Economia (%)</th>
<th data-quarto-table-cell-role="th">Custo por FN (R$)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Métricas Financeiras</td>
<td>-11.4%</td>
<td>25.5%</td>
<td>R$ -122.21</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="considerações-finais" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Considerações Finais</h1>
<p>Para avaliar o desempenho dos modelos na classe minoritária, foram calculadas métricas tradicionais de classificação, como acurácia, ROC AUC, PR AUC, precisão, recall e F1-Score. Entre essas, a métrica PR AUC (Precision-Recall AUC) é a mais relevante neste contexto, pois avalia de forma equilibrada a capacidade do modelo de detectar fraudes, considerando a desproporção entre classes.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 15%">
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>Modelo</th>
<th>Acurácia</th>
<th>ROC AUC</th>
<th>PR AUC</th>
<th>Precision</th>
<th>Recall</th>
<th>F1-Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Regressão Logística</td>
<td>0,9755</td>
<td>0,9741</td>
<td>0,7506</td>
<td>0,06</td>
<td>0,91</td>
<td>0,11</td>
</tr>
<tr class="even">
<td>Logistic Regression</td>
<td>0,9734</td>
<td>0,9669</td>
<td>0,7510</td>
<td>0,06</td>
<td>0,90</td>
<td>0,10</td>
</tr>
<tr class="odd">
<td>Regressão Logística Otimizada</td>
<td>0,9755</td>
<td>0,9741</td>
<td>0,7509</td>
<td>0,06</td>
<td>0,91</td>
<td>0,11</td>
</tr>
<tr class="even">
<td>Random Forest</td>
<td>0,9956</td>
<td>0,9709</td>
<td>0,6813</td>
<td>0,26</td>
<td>0,88</td>
<td>0,41</td>
</tr>
<tr class="odd">
<td>Random Forest Otimizado</td>
<td>0,9978</td>
<td>0,9666</td>
<td>0,4640</td>
<td>0,43</td>
<td>0,87</td>
<td>0,57</td>
</tr>
<tr class="even">
<td>Gradient Boosting</td>
<td>0,9988</td>
<td>0,9511</td>
<td>0,8307</td>
<td>0,60</td>
<td>0,85</td>
<td>0,70</td>
</tr>
<tr class="odd">
<td>XGBoost</td>
<td>0,9988</td>
<td>0,9685</td>
<td>0,8648</td>
<td>0,61</td>
<td>0,88</td>
<td>0,72</td>
</tr>
<tr class="even">
<td>Voting Classifier</td>
<td>0,9985</td>
<td>0,9693</td>
<td>0,8561</td>
<td>0,54</td>
<td>0,87</td>
<td>0,67</td>
</tr>
<tr class="odd">
<td>Stacking Classifier</td>
<td>0,9964</td>
<td>0,9698</td>
<td>0,7479</td>
<td>0,31</td>
<td>0,87</td>
<td>0,45</td>
</tr>
<tr class="even">
<td>Isolation Forest</td>
<td>0,9975</td>
<td>0,9421</td>
<td>0,1441</td>
<td>0,27</td>
<td>0,26</td>
<td>0,26</td>
</tr>
</tbody>
</table>
<p>Conforme observado, o XGBoost apresentou o melhor desempenho em PR AUC, o que indica sua superior capacidade de identificar corretamente transações fraudulentas mesmo em um dataset altamente desbalanceado. Essa métrica reforça a confiabilidade do modelo para aplicações práticas, mais relevante do que apenas acurácia ou recall isoladamente.</p>
<p>Além da avaliação estatística, é essencial analisar o impacto financeiro dos modelos, pois cada transação fraudulenta detectada ou não detectada afeta diretamente o caixa da empresa. Para isso, calculamos métricas como Impacto Líquido, ROI e Taxa de Economia, que traduzem o desempenho do modelo em termos monetários, facilitando a interpretação gerencial.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Modelo</th>
<th>Impacto Líquido (R$)</th>
<th>ROI (%)</th>
<th>Taxa de Economia (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>XGBoost</td>
<td>6.242,54</td>
<td>275,3%</td>
<td>87,7%</td>
</tr>
<tr class="even">
<td>Gradient Boosting</td>
<td>5.560,28</td>
<td>268,9%</td>
<td>84,7%</td>
</tr>
<tr class="odd">
<td>Voting Classifier</td>
<td>5.249,12</td>
<td>192,6%</td>
<td>86,7%</td>
</tr>
<tr class="even">
<td>Random Forest Otimizado</td>
<td>3.099,12</td>
<td>82,2%</td>
<td>86,7%</td>
</tr>
<tr class="odd">
<td>Stacking Classifier</td>
<td>-700,88</td>
<td>8,2%</td>
<td>86,7%</td>
</tr>
<tr class="even">
<td>Isolation Forest</td>
<td>-9.316,08</td>
<td>-11,4%</td>
<td>25,5%</td>
</tr>
<tr class="odd">
<td>Random Forest</td>
<td>-2.907,46</td>
<td>-12,1%</td>
<td>87,7%</td>
</tr>
<tr class="even">
<td>Regressão Logística</td>
<td>-59.523,20</td>
<td>-84,3%</td>
<td>90,8%</td>
</tr>
<tr class="odd">
<td>Regressão Logística Otimizada</td>
<td>-59.673,20</td>
<td>-84,3%</td>
<td>90,8%</td>
</tr>
</tbody>
</table>
<p>Conforme a tabela de resultados, o modelo XGBoost demonstrou ser o de melhor desempenho financeiro, gerando o maior Impacto Líquido e o maior ROI. Sua alta capacidade de identificar transações fraudulentas (alto recall) com um número relativamente baixo de falsos positivos (precisão) se traduziu diretamente em um lucro substancial para o negócio.</p>
<p>Os modelos de Boosting (XGBoost e Gradient Boosting) e de Ensemble (Voting Classifier e Stacking Classifier) em geral superaram os modelos de base, como o Random Forest e a Regressão Logística. Isso valida a abordagem de combinar múltiplos modelos ou construir modelos sequenciais para lidar com a complexidade do problema de fraude.</p>
<p>É notável, no entanto, que o Isolation Forest, apesar de ser um modelo não-supervisionado, obteve um impacto negativo significativo e um ROI negativo, o que o torna uma opção menos viável para este caso.</p>
<p>O resultado da análise financeira reforça que a escolha do modelo ideal vai além de métricas de acurácia, devendo-se considerar o impacto direto nas finanças da empresa.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiada");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiada");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>